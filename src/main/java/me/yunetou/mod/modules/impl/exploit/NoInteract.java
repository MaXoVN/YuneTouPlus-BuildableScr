package me.yunetou.mod.modules.impl.exploit;

import me.yunetou.api.events.impl.PacketEvent;
import me.yunetou.api.managers.impl.SneakManager;
import me.yunetou.api.util.interact.BlockUtil;
import me.yunetou.mod.modules.Category;
import me.yunetou.mod.modules.Module;
import net.minecraft.block.Block;
import net.minecraft.init.Blocks;
import net.minecraft.item.ItemAppleGold;
import net.minecraft.item.ItemBow;
import net.minecraft.item.ItemChorusFruit;
import net.minecraft.item.ItemEnderPearl;
import net.minecraft.item.ItemExpBottle;
import net.minecraft.network.play.client.CPacketPlayerTryUseItemOnBlock;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.RayTraceResult;
import net.minecraftforge.event.entity.player.PlayerInteractEvent;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

public class NoInteract
        extends Module {
    public NoInteract() {
        super("NoInteract", "Allows you to eat and throw exp when looking at tile entities", Category.EXPLOIT);
    }

    @SubscribeEvent
    public void onPacketSend(PacketEvent.Send event) {
        BlockPos pos;
        Block block;
        if (NoInteract.fullNullCheck()) {
            return;
        }
        RayTraceResult ray = NoInteract.mc.objectMouseOver;
        if (ray != null && ray.typeOfHit == RayTraceResult.Type.BLOCK && event.getPacket() instanceof CPacketPlayerTryUseItemOnBlock && ((block = BlockUtil.getBlock(pos = ray.getBlockPos())) == Blocks.ANVIL || block == Blocks.ENDER_CHEST) && this.check()) {
            event.setCanceled(true);
        }
    }

    @SubscribeEvent
    public void onInteract(PlayerInteractEvent.RightClickBlock event) {
        if (NoInteract.nullCheck()) {
            return;
        }
        Block block = BlockUtil.getBlock(event.getPos());
        if ((block == Blocks.ANVIL || block == Blocks.ENDER_CHEST) && this.check()) {
            event.setCanceled(true);
        }
    }

    private boolean check() {
        return !SneakManager.isSneaking && NoInteract.mc.gameSettings.keyBindUseItem.isKeyDown() && (NoInteract.mc.player.getHeldItemMainhand().getItem() instanceof ItemExpBottle || NoInteract.mc.player.getHeldItemMainhand().getItem() instanceof ItemEnderPearl || NoInteract.mc.player.getHeldItemMainhand().getItem() instanceof ItemAppleGold || NoInteract.mc.player.getHeldItemMainhand().getItem() instanceof ItemBow || NoInteract.mc.player.getHeldItemMainhand().getItem() instanceof ItemChorusFruit);
    }
}
