package me.yunetou.mod.modules.impl.exploit;

import com.mojang.authlib.GameProfile;
import java.util.ArrayList;
import java.util.UUID;

import me.yunetou.api.events.impl.PacketEvent;
import me.yunetou.mod.modules.Category;
import me.yunetou.mod.modules.Module;
import me.yunetou.mod.modules.settings.Setting;
import net.minecraft.client.entity.EntityOtherPlayerMP;
import net.minecraft.entity.Entity;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.world.GameType;
import net.minecraft.world.World;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

public class Blink
        extends Module {
    public static Blink INSTANCE = new Blink();
    private final ArrayList<Packet> packetsList = new ArrayList();
    private final Setting<Boolean> anyPacket = this.add(new Setting<>("AnyPacket", false));

    public Blink() {
        super("Blink", "Fake lag", Category.EXPLOIT);
        INSTANCE = this;
    }

    @Override
    public void onEnable() {
        if (Blink.fullNullCheck()) {
            return;
        }
        this.packetsList.clear();
        EntityOtherPlayerMP player = new EntityOtherPlayerMP(Blink.mc.world, new GameProfile(UUID.fromString("0f75a81d-70e5-43c5-b892-f33c524284f3"), "\u00a7aYou"));
        player.copyLocationAndAnglesFrom(Blink.mc.player);
        player.rotationYawHead = Blink.mc.player.rotationYawHead;
        player.rotationYaw = Blink.mc.player.rotationYaw;
        player.rotationPitch = Blink.mc.player.rotationPitch;
        player.setGameType(GameType.SURVIVAL);
        player.inventory.copyInventory(Blink.mc.player.inventory);
        player.setHealth(20.0f);
        Blink.mc.world.addEntityToWorld(-123456, player);
        player.onLivingUpdate();
    }

    @Override
    public void onTick() {
        if (Blink.mc.player.isDead) {
            this.disable();
        }
    }

    @Override
    public void onLogout() {
        if (this.isOn()) {
            this.disable();
        }
    }

    @Override
    public void onLogin() {
        if (this.isOn()) {
            this.disable();
        }
    }

    @SubscribeEvent
    public void onSendPacket(PacketEvent.Send event) {
        if (Blink.fullNullCheck()) {
            return;
        }
        if (event.getPacket() instanceof CPacketPlayer || this.anyPacket.getValue()) {
            this.packetsList.add(event.getPacket());
            event.setCanceled(true);
        }
    }

    @Override
    public void onDisable() {
        if (Blink.fullNullCheck()) {
            return;
        }
        Blink.mc.world.removeEntityFromWorld(-123456);
        for (Packet packet : this.packetsList) {
            Blink.mc.player.connection.sendPacket(packet);
        }
    }

    @Override
    public String getInfo() {
        return String.valueOf(this.packetsList.size());
    }
}